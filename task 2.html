<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FAQ Chatbot</title>
  <style>
    :root{
      --bg:#1A001A;            
      --card:#800080;          
      --muted:#FFFFFF;         
      --text:#FFFFFF;          
      --accent:#B320AE;        
      --accent-2:#FFFFFF;      
      --danger:#FF0000;        
      --bot:#800080;
      --user:#D42FAA;
      --ring: rgba(124,156,255,.5);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% -10%, #1A001A 0%, transparent 60%),
                  radial-gradient(1000px 700px at 120% 10%, #1A001A 0%, transparent 50%),
                  var(--bg);
      color:var(--text);
      display:grid; place-items:center; padding:24px;
    }
    .app{
      width:min(980px, 100%);
      display:grid; gap:16px;
    }
    .header{
      display:flex; align-items:center; gap:12px; justify-content:space-between;
    }
    .brand{display:flex; align-items:center; gap:12px}
    .logo{
      width:40px; height:40px; border-radius:12px; background: linear-gradient(135deg, var(--accent), var(--accent-2));
      display:grid; place-items:center; font-weight:800; color:#800080;
      box-shadow: 0 10px 30px rgba(124,156,255,.25);
    }
    .title{font-weight:700; letter-spacing:.3px}
    .muted{color:var(--muted); font-size:.95rem}

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,.06);
      border-radius:16px; backdrop-filter: blur(8px);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }

    .chat{
      height: min(62vh, 640px);
      overflow:auto; padding:16px; display:flex; flex-direction:column; gap:12px;
      scroll-behavior:smooth;
    }
    .msg{display:flex; gap:10px; max-width: 85%}
    .msg.user{align-self:flex-end; flex-direction:row-reverse}
    .bubble{
      padding:12px 14px; border-radius:14px; line-height:1.35; font-size:1rem;
      background:var(--bot); border:1px solid rgba(255,255,255,.05);
      box-shadow: inset 0 -20px 40px rgba(0,0,0,.15);
      word-wrap:break-word; white-space:pre-wrap
    }
    .user .bubble{background:var(--user)}
    .avatar{width:34px; height:34px; border-radius:10px; background:#800080; display:grid; place-items:center; font-weight:700; color:#FFFFFF}
    .user .avatar{background:#800080; color:#FFFFFF}

    .composer{display:flex; gap:10px; padding:10px; align-items:stretch}
    .input{flex:1; display:flex; background:var(--card); border-radius:14px; padding:8px; gap:8px; border:1px solid rgba(255,255,255,.06)}
    .input:focus-within{outline: 2px solid var(--ring)}
    textarea{
      resize:none; flex:1; background:transparent; border:0; color:var(--text); padding:8px 10px;
      font:inherit; height:44px; max-height:160px; line-height:1.35
    }
    textarea::placeholder{color:#99a4c4}
    .btn{
      border:0; padding:0 16px; border-radius:12px; background:var(--accent); color:#800080; font-weight:700;
      display:inline-flex; align-items:center; justify-content:center; cursor:pointer; transition: .2s transform ease, .2s opacity ease; min-width:84px
    }
    .btn:hover{transform: translateY(-1px)}
    .btn.secondary{background:#800080; color:#FFFFFF; border:1px solid rgba(255,255,255,.08); min-width:auto; padding:0 12px}

    .suggestions{display:flex; flex-wrap:wrap; gap:8px; padding:8px 12px}
    .chip{background:#8F098F; color:#FFFFFF; border:1px solid rgba(255,255,255,.06); border-radius:999px; padding:8px 12px; cursor:pointer; font-size:.92rem}
    .chip:hover{background:#800080}

    details.how{ padding:12px 14px; }
    details summary{cursor:pointer; color:#AD13AD}
    code.inline{background:#8F098F; padding:2px 6px; border-radius:6px; border:1px solid rgba(255,255,255,.06)}

    .small{font-size:.9rem}
  </style>
</head>
<body>
  <main class="app">
    <section class="header">
      <div class="brand">
        <div class="logo">FAQ</div>
        <div>
          <div class="title">FAQ Chatbot</div>
          <div class="muted">Cosine similarity over TF-IDF (no servers, no libs)</div>
        </div>
      </div>
      <button class="btn secondary" id="clearBtn" title="Clear conversation">Clear</button>
    </section>

    <section class="card">
      <div id="chat" class="chat" aria-live="polite" aria-label="Chat transcript"></div>
      <div class="suggestions" id="suggestions"></div>
      <div class="composer">
        <div class="input">
          <textarea id="q" placeholder="Ask a questionâ€¦ (e.g., How do I track my order?)" aria-label="Your question"></textarea>
        </div>
        <button class="btn" id="send">Send â†µ</button>
      </div>
    </section>

    <details class="card how small">
      <summary>How it works</summary>
      <p>
        Type a question. We preprocess (lowercase, strip punctuation, remove stopwords), build a TF-IDF vector for your query, and compute cosine similarity against all FAQ vectors. The highest-scoring answer is returned if it passes a confidence threshold; otherwise we show the closest match plus a nudge to rephrase.
      </p>
      <p>
        Edit the <code class="inline">faqs</code> array in the source to add your own questions & answers. Everything runs locally in your browserâ€”no external dependencies.
      </p>
    </details>
  </main>

  <script>
    const faqs = [
      { q: "How do I track my order?", a: "Open your account â†’ Orders â†’ Track. Or paste your order ID on the Track page." },
      { q: "What is your return policy?", a: "30-day returns on unused items in original packaging. Start a return from your Orders page." },
      { q: "How long does shipping take?", a: "Standard shipping takes 3â€“5 business days; express is 1â€“2 days at checkout." },
      { q: "Do you ship internationally?", a: "Yes. We ship to 40+ countries. Duties/taxes may be collected at delivery depending on destination." },
      { q: "Which payment methods are accepted?", a: "We accept major credit/debit cards, PayPal, Apple Pay, and Google Pay." },
      { q: "Can I cancel or change my order?", a: "Orders can be edited within 30 minutes of placement from the Orders page. After that, contact support." },
      { q: "Is there a warranty?", a: "All products include a 1-year limited warranty covering manufacturing defects." },
      { q: "How do I contact support?", a: "Use live chat from 9amâ€“6pm (Monâ€“Fri) or email support@example.com." },
      { q: "How do I reset my password?", a: "On the login page, click â€˜Forgot passwordâ€™, then follow the email instructions." },
      { q: "How is my data used?", a: "We only use your data to provide the service. See the Privacy Policy for details and opt-out settings." },
    ];

    const STOPWORDS = new Set([
      'a','an','and','are','as','at','be','but','by','for','from','has','have','how','i','if','in','into','is','it','its','of','on','or','our','s','so','that','the','their','to','we','what','when','where','which','who','why','with','you','your','do','does','can','my','me'
    ]);

    const tokenize = (text) => text
      .toLowerCase()
      .replace(/[^\p{L}\p{N}\s]/gu, ' ')
      .split(/\s+/)
      .filter(t => t && !STOPWORDS.has(t));

    const N = faqs.length;
    const docs = faqs.map(f => tokenize(f.q + ' ' + f.a));
    const df = new Map();
    docs.forEach(tokens => {
      const uniq = new Set(tokens);
      uniq.forEach(t => df.set(t, (df.get(t)||0) + 1));
    });
    const vocab = Array.from(df.keys());
    const idf = new Map(vocab.map(t => [t, Math.log(1 + (N + 1) / ((df.get(t) || 0) + 1)) + 1]));

    function tf(tokens){
      const m = new Map();
      tokens.forEach(t => m.set(t, (m.get(t)||0) + 1));
      const out = new Map();
      const len = tokens.length || 1;
      m.forEach((count, term) => out.set(term, count / len));
      return out;
    }
    function vectorize(tokens){
      const t = tf(tokens);
      const vec = new Map();
      t.forEach((w, term) => {
        const idfVal = idf.get(term) || 0;
        vec.set(term, w * idfVal);
      });
      return vec;
    }
    function cosine(a,b){
      let dot=0, na=0, nb=0;
      const keys = new Set([...a.keys(), ...b.keys()]);
      keys.forEach(k => {
        const va = a.get(k) || 0; const vb = b.get(k) || 0;
        dot += va*vb; na += va*va; nb += vb*vb;
      });
      return dot / (Math.sqrt(na||1)*Math.sqrt(nb||1));
    }

    const docVectors = docs.map(vectorize);

    function bestMatch(query){
      const qTokens = tokenize(query);
      if(qTokens.length === 0) return { idx:-1, score:0 };
      const qVec = vectorize(qTokens);
      let best = { idx:-1, score:0 };
      docVectors.forEach((dv, i) => {
        const s = cosine(qVec, dv);
        if(s > best.score) best = { idx:i, score:s };
      });
      return best;
    }

    const chat = document.getElementById('chat');
    const input = document.getElementById('q');
    const sendBtn = document.getElementById('send');
    const clearBtn = document.getElementById('clearBtn');
    const suggestions = document.getElementById('suggestions');

    function el(tag, cls, text){
      const e = document.createElement(tag);
      if(cls) e.className = cls; if(text) e.textContent = text; return e;
    }

    function addMessage(text, who='bot'){
      const row = el('div', `msg ${who}`);
      const avatar = el('div', 'avatar', who==='bot' ? 'BOTðŸ¤–' : 'YOUðŸ˜ƒ');
      const bubble = el('div', 'bubble'); bubble.innerText = text;
      row.appendChild(avatar); row.appendChild(bubble);
      chat.appendChild(row); chat.scrollTop = chat.scrollHeight;
    }

    function replyTo(query){
      const { idx, score } = bestMatch(query);
      const CONF = 0.12; 
      if(idx === -1){
        addMessage("I couldn't parse that. Try rephrasing.");
        return;
      }
      const best = faqs[idx];
      if(score >= CONF){
        addMessage(best.a); // <-- Removed confidence display
      } else {
        addMessage(`I'm not fully sure, but this seems related: "${best.q}"\n\n${best.a}\n\n(Try rephrasing or ask a shorter question.)`);
      }
    }

    function showSuggestions(){
      suggestions.innerHTML = '';
      const picks = faqs.slice(0,6);
      picks.forEach(f => {
        const c = el('button', 'chip', f.q);
        c.addEventListener('click', () => {
          input.value = f.q; input.focus();
        });
        suggestions.appendChild(c);
      });
    }

    function send(){
      const val = input.value.trim(); if(!val) return;
      addMessage(val, 'user'); input.value='';
      setTimeout(() => replyTo(val), 250);
    }

    sendBtn.addEventListener('click', send);
    input.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); send(); }
    });
    clearBtn.addEventListener('click', () => { chat.innerHTML=''; addMessage('Hi! Ask me anything about orders, shipping, returns, payments, and support.'); });

    addMessage('Hi! Ask me anything about orders, shipping, returns, payments, and support.');
    showSuggestions();
  </script>
</body>
</html>
